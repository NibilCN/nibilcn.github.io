<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.12.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="《嵌入式Linux应用完全开发手册》第2篇第13章总结归纳">
<meta property="og:type" content="article">
<meta property="og:title" content="LCD控制器">
<meta property="og:url" content="http://example.com/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/index.html">
<meta property="og:site_name" content="Laugh Tale">
<meta property="og:description" content="《嵌入式Linux应用完全开发手册》第2篇第13章总结归纳">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/1.jpeg">
<meta property="og:image" content="http://example.com/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/2.jpeg">
<meta property="og:image" content="http://example.com/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/3.jpeg">
<meta property="og:image" content="http://example.com/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/4.jpeg">
<meta property="og:image" content="http://example.com/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/5.jpeg">
<meta property="og:image" content="http://example.com/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/6.jpeg">
<meta property="og:image" content="http://example.com/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/7.jpeg">
<meta property="og:image" content="http://example.com/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/8.jpeg">
<meta property="article:published_time" content="2022-08-27T02:34:40.000Z">
<meta property="article:modified_time" content="2022-08-27T02:34:40.000Z">
<meta property="article:author" content="Nibil">
<meta property="article:tag" content="嵌入式Linux">
<meta property="article:tag" content="LCD">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/1.jpeg">


<link rel="canonical" href="http://example.com/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":"","permalink":"http://example.com/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/","path":"2022/08/27/LCD控制器/","title":"LCD控制器"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LCD控制器 | Laugh Tale</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
  <!--pjax：防止跳转页面音乐暂停-->
  <script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Laugh Tale</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">A Nibil's Sharing Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%AC%E7%AB%A0%E7%9B%AE%E6%A0%87"><span class="nav-number">1.</span> <span class="nav-text">本章目标</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#LCD%E5%92%8CLCD%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">2.</span> <span class="nav-text">LCD和LCD控制器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#LCD%E6%98%BE%E7%A4%BA%E5%99%A8"><span class="nav-number">2.1.</span> <span class="nav-text">LCD显示器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#LCD%E7%9A%84%E7%A7%8D%E7%B1%BB"><span class="nav-number">2.1.1.</span> <span class="nav-text">LCD的种类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LCD%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="nav-number">2.1.2.</span> <span class="nav-text">LCD的接口</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#S3C2410-x2F-S3C2440-LCD%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.2.</span> <span class="nav-text">S3C2410&#x2F;S3C2440 LCD控制器介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#S3C2410-x2F-S3C2440-LCD%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84%E7%89%B9%E6%80%A7%E4%B8%8E%E7%BB%93%E6%9E%84"><span class="nav-number">2.2.1.</span> <span class="nav-text">S3C2410&#x2F;S3C2440 LCD控制器的特性与结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%98%BE%E7%A4%BA%E5%99%A8%E4%B8%8A%E6%95%B0%E6%8D%AE%E7%9A%84%E7%BB%84%E7%BB%87%E6%A0%BC%E5%BC%8F"><span class="nav-number">2.2.2.</span> <span class="nav-text">显示器上数据的组织格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TFT-LCD%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="nav-number">2.2.3.</span> <span class="nav-text">TFT LCD的操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8TFT-LCD%E6%97%B6LCD%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84%E5%AF%84%E5%AD%98%E5%99%A8%E8%AE%BE%E7%BD%AE"><span class="nav-number">2.2.4.</span> <span class="nav-text">使用TFT LCD时LCD控制器的寄存器设置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#TFT-LCD%E6%98%BE%E7%A4%BA%E5%AE%9E%E4%BE%8B"><span class="nav-number">3.</span> <span class="nav-text">TFT LCD显示实例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.1.</span> <span class="nav-text">程序设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.2.</span> <span class="nav-text">代码设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#main-c"><span class="nav-number">3.2.1.</span> <span class="nav-text">main.c</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lcdlib-c"><span class="nav-number">3.2.2.</span> <span class="nav-text">lcdlib.c</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lcddrv-c"><span class="nav-number">3.2.3.</span> <span class="nav-text">lcddrv.c</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#framebuffer-c"><span class="nav-number">3.2.4.</span> <span class="nav-text">framebuffer.c</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Nibil</p>
  <div class="site-description" itemprop="description">A Nibil's Sharing Blog</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">35</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/NibilCN" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;NibilCN" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



        </div>
      </div>
    </div>
    <div class="sidebar-inner">
      <!-- require APlayer -->
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
      <script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
      <!-- require MetingJS -->
      <script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
      <!--网易云-->   
      <meting-js
        server="netease"
        id="7593069088"
        type="playlist" 
        mini="false"
        fixed="false"
        list-folded="true"
        autoplay="true"
        volume="0.4"
        theme="#FADFA3"
        order="random"
        loop="all"
        preload="auto"
        mutex="true">
      </meting-js>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/NibilCN" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nibil">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Laugh Tale">
      <meta itemprop="description" content="A Nibil's Sharing Blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="LCD控制器 | Laugh Tale">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          LCD控制器
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-08-27 10:34:40" itemprop="dateCreated datePublished" datetime="2022-08-27T10:34:40+08:00">2022-08-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/%E4%B9%A6%E7%B1%8D/" itemprop="url" rel="index"><span itemprop="name">书籍</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/%E4%B9%A6%E7%B1%8D/%E5%B5%8C%E5%85%A5%E5%BC%8FLinux%E5%BA%94%E7%94%A8%E5%AE%8C%E5%85%A8%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C/" itemprop="url" rel="index"><span itemprop="name">嵌入式Linux应用完全开发手册</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/%E4%B9%A6%E7%B1%8D/%E5%B5%8C%E5%85%A5%E5%BC%8FLinux%E5%BA%94%E7%94%A8%E5%AE%8C%E5%85%A8%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C/%E7%AC%AC2%E7%AF%87%E7%AC%AC13%E7%AB%A0-LCD%E6%8E%A7%E5%88%B6%E5%99%A8/" itemprop="url" rel="index"><span itemprop="name">第2篇第13章 LCD控制器</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>18k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>17 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>《嵌入式Linux应用完全开发手册》第2篇第13章总结归纳</p>
<span id="more"></span>
<h1 id="本章目标"><a href="#本章目标" class="headerlink" title="本章目标"></a>本章目标</h1><ol>
<li>了解LCD显示器的接口及时序</li>
<li>掌握S3C2410&#x2F;S3C2440LCD控制器的使用方法</li>
<li>了解帧缓冲区的概念，掌握如何设置帧缓冲区来显示图像</li>
</ol>
<h1 id="LCD和LCD控制器"><a href="#LCD和LCD控制器" class="headerlink" title="LCD和LCD控制器"></a>LCD和LCD控制器</h1><h2 id="LCD显示器"><a href="#LCD显示器" class="headerlink" title="LCD显示器"></a>LCD显示器</h2><h3 id="LCD的种类"><a href="#LCD的种类" class="headerlink" title="LCD的种类"></a>LCD的种类</h3><p>LCD（Liquid Crystal Display），即液晶显示器，是一种采用了液晶控制透光度技术来实现色彩的显示器。它与传统的CRT显示器相比有很多优点：轻薄、能耗低、辐射小等，市场占有率越来越大。LCD有很多种类，比如STN、TFT、LTPS TFT、OLED等，各有优缺点。<br>STN（Super Twisted Nematic，超扭曲向列），有CSTN和DSTN之分，是4种LCD屏中最低端的一种，仅有的优点就是功耗低，在色彩鲜艳度和画面亮度上相对于TFT和其他LCD屏存在明显不足，在日光下几乎不能显示，而且响应时间长达200ms左右，播放动画或视频拖影明显不足。<br>TFT（Thin Film Transistor，薄膜晶体管）可以大大缩短屏幕响应时间，其响应时间已经小于80ms，并改善了STN连续显示时屏幕闪烁模糊，有效提供了动态画面的播放力，呈现画面色彩饱和度、真实效果和对比度都很不错，完全超越STN，只是功耗稍高，是目前最为主流的液晶显示器类型。在MP3、MP4产品上大量应用，在桌面液晶显示器、笔记本电脑、手机等产品上的应用也非常普遍。<br>LTPS（Low Temperature Polycrystalline Silicon，低温多晶硅）由TFT衍生的新一代的技术产品，可以获得更高的分辨率和更丰富的色彩。LTPS LCD可以提供170°的水平和垂直可视角度，显示响应仅12ms，显示亮度达到500Cd&#x2F;m²，对比度可达500：1，这就是一些桌面液晶屏性能越来越出色的原因。虽然LTPS LCD已经出现很多年了，但由于LTPS TFT液晶屏的制造需要高于制造传统TFT屏的技术水平，目前仅有少数知名大厂能制造。<br>OLED（Organic Light Emitted Diode，有机发光二极管）各种物理特性都具备领先优势，色彩明亮、可视角度超大、非常省电，是未来发展的主流，只是目前受技术与成本限制，未能广泛普及。目前，彩色OLED比较广泛的存在中低端产品中。</p>
<h3 id="LCD的接口"><a href="#LCD的接口" class="headerlink" title="LCD的接口"></a>LCD的接口</h3><p>CPU或显卡发出的图像是TTL信号，LCD本身接收的也是TTL信号。但是由于TTL信号高速率的长距离传输性能不佳，抗干扰能力也比较差，后来又提出了多种接口，比如LVDS、TDMS、GVIF、P&amp;D、DVI和DFP等。它们实际上只是将CPU或显卡发出的TTL信号编码成各种信号以便传输，在LCD那边将接收到的信号进行解码得到TTL信号。<br>由于数字接口标准尚未统一，所以使用LCD时需要根据其手册了解具体接口定义。也是基于数字接口标准尚未统一的原因，市场上大多LCD都采用模拟接口信号，LCD先通过ADC将模拟信号转换为数字信号才能显示。<br>但是不管采用何种数字接口，本质的TTL信号是一样的。</p>
<ol>
<li><p>对于STN LCD<br>STN LCD 的数据传输方式有3种：4位单扫（4-bit single scan）、4位双扫（4-bit dual scan）、8位单扫（8-bit single scan）。所谓“单扫”是指对于一整屏的数据，从上到下、从左到右，一个一个的发送出来；“双扫”是指将一整屏的数据分为上下两部分，同时从上到下、从左到右，一个一个的发送出来。“4位”、“8位”是指发送数据时使用多少个数据线；需要注意的是，4位双扫方式也是用到8根数据线，其中4根用于上半屏数据，另外4根用于下半屏数据。<br>除数据信号外，还有其他控制信号，所有TTL信号如下表所示：</p>
<table>
<thead>
<tr>
<th>信号名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>VFRAME</td>
<td>帧同步信号</td>
</tr>
<tr>
<td>VLINE</td>
<td>行同步信号</td>
</tr>
<tr>
<td>VCLK</td>
<td>像素时钟信号</td>
</tr>
<tr>
<td>VD[7:0]</td>
<td>数据信号</td>
</tr>
<tr>
<td>VM</td>
<td>AV偏置信号</td>
</tr>
<tr>
<td>PWREN</td>
<td>电源开关信号</td>
</tr>
</tbody></table>
</li>
<li><p>对于TFT LCD<br>TFT LCD的信号与STN类似，只是其数据信号多达24根，对应像素值的每一位。</p>
<table>
<thead>
<tr>
<th>信号名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>VSYNC</td>
<td>垂直同步信号</td>
</tr>
<tr>
<td>HSYNC</td>
<td>水平同步信号</td>
</tr>
<tr>
<td>HCLK</td>
<td>像素时钟信号</td>
</tr>
<tr>
<td>VD[23:0]</td>
<td>数据信号</td>
</tr>
<tr>
<td>LEND</td>
<td>行结束信号</td>
</tr>
<tr>
<td>PWREN</td>
<td>电源开关信号</td>
</tr>
</tbody></table>
</li>
</ol>
<h2 id="S3C2410-x2F-S3C2440-LCD控制器介绍"><a href="#S3C2410-x2F-S3C2440-LCD控制器介绍" class="headerlink" title="S3C2410&#x2F;S3C2440 LCD控制器介绍"></a>S3C2410&#x2F;S3C2440 LCD控制器介绍</h2><h3 id="S3C2410-x2F-S3C2440-LCD控制器的特性与结构"><a href="#S3C2410-x2F-S3C2440-LCD控制器的特性与结构" class="headerlink" title="S3C2410&#x2F;S3C2440 LCD控制器的特性与结构"></a>S3C2410&#x2F;S3C2440 LCD控制器的特性与结构</h3><p>S3C2410&#x2F;S3C2440 LCD控制器被用来向LCD传输图像数据，并提供必要的控制信号，比如VFRAME、VLINE、VCLK、VM等。可以支持STN LCD、TFT LCD，其特性如下（BPP 表示bit per pixel，即每个颜色像素点用多少位来表示）。<br>STN LCD</p>
<ol>
<li>支持3种扫描方式：4位单扫，4位双扫和8位单扫</li>
<li>支持单色（1BPP）、4级灰度（2BPP）、16级灰度屏（4BPP）</li>
<li>支持256色（8BPP）和4096色（12BPP）彩色STN屏（CSTN）</li>
<li>支持分辨率为640x480、320x240、160x160以及其他规格的多种LCD</li>
<li>虚拟屏幕最大可达4MB</li>
<li>对于256色，分辨率有4094x1024、2048x2048、1024x4096等多种</li>
</ol>
<p>TFT LCD</p>
<ol>
<li>支持单色（1BPP）、4级灰度（2BPP）、16级灰度（4BPP）、256色（8BPP）的调色板显示模式</li>
<li>支持64K（16BPP）和16M（24BPP）色非调色板显示模式</li>
<li>支持分辨率为640x480、320x320及其他多种规格的LCD</li>
<li>虚拟屏幕最大可达4MB</li>
<li>对于64K色，分辨率有2048x1024等多种</li>
</ol>
<p>S3C2410&#x2F;S3C2440 LCD控制器提供了驱动STN LCD、TFT LCD所需的所有信号，另外，还特别提供额外的信号以支持SEC公司生产的TFT LCD。这3类信号中很大部分是复用的。<br>S3C2410&#x2F;S3C2440 LCD控制器的内部结构如下图所示：<br><img src="/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/1.jpeg" alt="img not found"><br>REGBANK是LCD控制器的寄存器组，含17个寄存器及一块256x16的调色板内存，用来设置各项参数。而LCDCDMA则是LCD控制器专用的DMA通道，可以自动地从系统总线（System Bus）上取到图像数据，这使得显示图像时不需要CPU的干涉。VIDPRCS将LCDCDMA中的数据组合成特定的格式，然后从VD[23:0]发送给LCD屏。同时TIMEGEN和LPC3600负责产生LCD屏所需要的控制时序，例如VSYNC、HSYNC、VCLK、VDEN，然后从VIDEO MUX送给LCD屏。其中LPC3600专用于SEC TFT LCD。<br>LCDCDMA中有2个FIFO：FIFOH容量为16（1个字为4个字节）个字，FIFOL容量为12个字。当使用“双扫”方式时，FIFOH、FIFIL分别用于传输上半屏、下班屏数据；当使用“单扫”方式时，只用到FIFOH。当FIFO为空或者其中的数据已经减少到设定的阈值时，LCDCDMA自动的发起DMA传输从内存中获得图像数据。</p>
<h3 id="显示器上数据的组织格式"><a href="#显示器上数据的组织格式" class="headerlink" title="显示器上数据的组织格式"></a>显示器上数据的组织格式</h3><p>一幅图像被称为一帧，每帧由多行组成，每行由多个像素组成，每个像素的颜色用若干位的数据表示。对于单色显示器，每个像素用1位来表示，称为1BPP，对于256色显示器，每个像素使用8位来表示，称为8BPP。<br>显示器从屏幕的左上方开始，一行一行的取得每个像素的数据并显示出来，当显示当一行的最右边时，跳到下一行的最左边开始显示下一行；当显示完所有行后，跳到左上方开始显示下一帧。显示器沿着“Z”字行的路线进行扫描，使用HSYNC、VSYNC信号来控制扫描路线的跳转。HSYNC表示“是时候跳到最左边了”，VSYNC表示“是时候跳到最上边了”。<br>在工作中的显示器上，可以在四周看到黑色的边框。上方的黑框是因为显示完所有行的数据时，显示器还没有扫描到最下边（VSYNC信号还未发出），这时数据已经无效。左边的黑框是因为当发出HSYNC信号时，需要经过若干像素之后第一列数据才有效；右边的黑框是因为显示完一行的数据时，显示器还每扫描到最右边（HSYNC信号还没有发出），这时数据已经无效。显示器只会依据VSYNC、HSYNC信号来取得、显示数据，并不理会该数据是否有效，何时发出有效数据由显卡决定。<br>VSYNC信号出现的频率表示1秒内能显示多少帧的图像，称为垂直频率或者场频率，这就是我们常说的“显示器的频率”；HSYNC信号出现的频率称为水平频率。<br>显示器上，一帧数据的存放位置与VSYNC、HSYNC信号的关系如下图所示：<br><img src="/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/2.jpeg" alt="img not found"><br>有效数据的行数、列数即分辨率，它与VSYNC、HSYNC信号之间的“距离”等，都是可以设置的，这由显卡完成。</p>
<h3 id="TFT-LCD的操作"><a href="#TFT-LCD的操作" class="headerlink" title="TFT LCD的操作"></a>TFT LCD的操作</h3><p>目前市场上主流的LCD为TFT LCD，先了解TFT LCD的时序，这使得我们在设置各个寄存器时有个形象的概念。每个VSYNC信号表示一帧数据的开始；每个HSYNC信号表示一行数据的开始，无论这些数据是否有效；每个VCLK信号表示正在传输一个像素的数据，无论它是否有效。数据是否有效只是对CPU的LCD控制器来说的，LCD根据VSYNC、HSYNC、VCLK不停的读取总线数据、显示。<br><img src="/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/3.jpeg" alt="img not found"></p>
<ol>
<li>VSYNC信号有效时，表示一帧数据的开始。</li>
<li>VSPW表示VSYNC信号的脉冲宽度为（VSPW + 1）个HSYNC信号周期，即（VSPW + 1）行，这（VSPW + 1）行数据无效。</li>
<li>VSYNC信号脉冲之后，还要经过（VBPD + 1）个HSYNC信号周期，有效的行数据才出现。所以在VSYNC信号有效之后，总共还要经过（VSPW + 1 + VBPD + 1）个无效的行，它对应图13.2上方的边框，第一个有效的行才出现。</li>
<li>随后即连续发出（LINEVAL + 1）行的有效数据。</li>
<li>最后是（VFPD + 1）个无效的行，它对应图13.2下方的边框，完整的一帧结束，紧接着就是下一帧的数据了（即下一个VSYNC信号）。</li>
</ol>
<p>现在深入到一行像素的传输过程。类似于行数据的传输过程。</p>
<ol>
<li>HSYNC信号有效时，表示一行数据的开始。</li>
<li>HSPW表示HSYNC信号的脉冲宽度为（HSPW + 1）个VCLK信号周期，即（HSPW + 1）个像素，这（HSPW + 1）个像素的数据无效。</li>
<li>HSYNC信号脉冲无效之后，还要经过（HBPD + 1）个VCLK信号周期，有效的像素数据才出现。所以，在HSYNC信号有效之后，总共还要经过（HSPW + 1 + HBPD + 1）个无效的像素，它对应图13.2的左边框，第一个有效像素才出现。</li>
<li>随后即连续发出（HOZVAL + 1）个像素的有效数据。</li>
<li>最后是（HFPD + 1）个无效的像素，它对应图13.2的右边框，完整的一行结束，紧接着就是下一行的数据了（即下一个HSYNC信号）。</li>
</ol>
<p>时序图中各信号的时间参数都可以在LCD控制寄存器中设置，VCLK作为时序图的基准信号，它的频率可由此计算：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VCLK(hz) = HCLK / [(CLKVAL + <span class="number">1</span> x <span class="number">2</span>)]</span><br></pre></td></tr></table></figure>
<p>VSYNC信号的频率又称为帧频率、垂直频率、场频率、显示器的频率，它可以如下计算：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Frame Rate = <span class="number">1</span>/[&#123;(VSPW+<span class="number">1</span>)+(VBPD+<span class="number">1</span>)+(LINEVAL+<span class="number">1</span>)+(VFPD+<span class="number">1</span>)&#125; x &#123; (HSPW+<span class="number">1</span>)+(HBPD+<span class="number">1</span>)+(HFPD+<span class="number">1</span>)+(HOZVAL+<span class="number">1</span>) &#125; x &#123; <span class="number">2</span> x ( CLKVAL+<span class="number">1</span>) / (HCLK)&#125;]</span><br></pre></td></tr></table></figure>
<p>将VSYNC、HSYNC、VCLK等信号的时间参数设置好之后，并将帧内存（frame memory）的地址告诉LCD控制器，它即可自动发起DMA传输从帧内存得到图像数据，最终在上述信号的控制下出现在数据总线VD[23:0]上。用户只需要把要显示的图像数据写入帧内存中。<br>下面介绍各种图像的格式数据在内存中如何存储。<br>显示器上的每个像素的颜色都是由3个部分组成：红、绿、蓝。它们被称为三原色，这三者的混合几乎可以表示人眼所能识别到的所有颜色。比如可以根据颜色的浓烈程度将三原色都分为256个级别（0-255）。可以使用255级的红色、255级的绿色、255级的蓝色可以组成白色。0级的红色、0级的绿色、0级的蓝色可以组成黑色。<br>LCD控制器可以支持单色（1BPP）、4级灰度（2BPP）、16级灰度（8BPP）、256色（8BPP）的调色板显示模式，支持64K（16BPP）和16M（24BPP）非调色板显示模式。下面只介绍256色（8pp）、64K（16BPP）和16M（24BPP）色显示模式下，图像数据的存储格式。</p>
<ol>
<li>16M（24BPP）色<br>16M（24BPP）色的显示模式就是使用24位的数据来表示一个像素的颜色，每种原色使用8位。LCD控制器从内存中获得某个像素的24位颜色值后，直接通过VD[23:0]数据线发送给LCD。为了方便DMA传输，在内存中使用4个字节（32）位来表示一个像素，其中的3个字节从高到低分别表示红、绿、蓝，剩余的1个字节数据无效。是最低字节还是最高字节无效，这时可以选择的。<br><img src="/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/4.jpeg" alt="img not found"></li>
<li>64K（16BPP）色<br>64K（16BPP）色的显示模式就是使用16位的数据来表示一个像素的颜色。这16位数据的格式又分为两种：5：6：5、5：5：5：1，前者使用高5位来表示红色，中间的6位来表示绿色，低5位来表示蓝色；后者的高15位从高到低分成3个5位来表示红色、绿色、蓝色，最低位表示透明度。5：5：5：1的格式也被称为RGBA（A表示Alpha，指代透明度）。<br>一个4字节可以表示两个16BPP的像素，使用高2字节还是低2字节来表示第一个像素，这也是可以选择的。<br>显示模式为16BPP时，内存数据与像素位置的关系如图所示：<br><img src="/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/5.jpeg" alt="img not found"><br>在5：5：5：1的格式下，VD[18]、VD[10]、VD[2]数据线上的值是一样的，都表示透明度。图中的NC表示没有连接（not connect）。</li>
<li>256（8BPP）色<br>256（8BPP）色的显示模式就是使用8位的数据来表示一个像素的颜色，但是对三种原色平均下来，每个原色只能使用不到3位的数据来表示，即每个原色最多不过8个级别，这不足以表示更丰富的颜色。<br>为了解决8BPP模式显示能力太弱的问题，需要使用调色板。每个像素对应8位数据不再用来表示RGB三原色，而是表示它在调色板中的索引值；要显示这个像素时，使用这个索引值从调色板中取得其RGB颜色值。所谓调色板就是一块内存，可以对每个索引值设置其颜色，可以使用24BPP或16BPP。S3C2410&#x2F;S3C2440中，调色板是一块256x16的内存，使用16BPP的格式来表示256色（8BPP）显示模式下各个索引值的颜色。这样即使使用256色（8BPP）的显示模式，最终在LCD数据总线上的仍是16BPP的数据。<br>一个4字节可以表示4个8BPP的像素，字节与像素的对应顺序是可以选择的，如下图所示：<br><img src="/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/6.jpeg" alt="img not found"><br>调色板中数据的存放格式与16BPP显示模式类似，也分为两种：5：6：5、5：5：5：1。调色板中数据的格式及与LCD数据线VD[23:0]的对应关系，如下表所示：</li>
</ol>
<p>5：6：5格式下调色板的数据格式</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>15</th>
<th>14</th>
<th>13</th>
<th>12</th>
<th>11</th>
<th>10</th>
<th>9</th>
<th>8</th>
<th>7</th>
<th>6</th>
<th>5</th>
<th>4</th>
<th>3</th>
<th>2</th>
<th>1</th>
<th>0</th>
<th>地址</th>
</tr>
</thead>
<tbody><tr>
<td>00H</td>
<td>R4</td>
<td>R3</td>
<td>R2</td>
<td>R1</td>
<td>R0</td>
<td>G5</td>
<td>G4</td>
<td>G3</td>
<td>G2</td>
<td>G1</td>
<td>G0</td>
<td>B4</td>
<td>B3</td>
<td>B2</td>
<td>B1</td>
<td>B0</td>
<td>0X4D000400</td>
</tr>
<tr>
<td>01H</td>
<td>R4</td>
<td>R3</td>
<td>R2</td>
<td>R1</td>
<td>R0</td>
<td>G5</td>
<td>G4</td>
<td>G3</td>
<td>G2</td>
<td>G1</td>
<td>G0</td>
<td>B4</td>
<td>B3</td>
<td>B2</td>
<td>B1</td>
<td>B0</td>
<td>0X4D000404</td>
</tr>
<tr>
<td>… …</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>… …</td>
</tr>
<tr>
<td>FFH</td>
<td>R4</td>
<td>R3</td>
<td>R2</td>
<td>R1</td>
<td>R0</td>
<td>G5</td>
<td>G4</td>
<td>G3</td>
<td>G2</td>
<td>G1</td>
<td>G0</td>
<td>B4</td>
<td>B3</td>
<td>B2</td>
<td>B1</td>
<td>B0</td>
<td>0X4D0007FC</td>
</tr>
<tr>
<td>VD引脚号</td>
<td>23</td>
<td>22</td>
<td>21</td>
<td>20</td>
<td>19</td>
<td>15</td>
<td>14</td>
<td>13</td>
<td>12</td>
<td>11</td>
<td>10</td>
<td>7</td>
<td>6</td>
<td>5</td>
<td>4</td>
<td>3</td>
<td></td>
</tr>
</tbody></table>
<p>5：5：5：1格式下调色板的数据格式</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>15</th>
<th>14</th>
<th>13</th>
<th>12</th>
<th>11</th>
<th>10</th>
<th>9</th>
<th>8</th>
<th>7</th>
<th>6</th>
<th>5</th>
<th>4</th>
<th>3</th>
<th>2</th>
<th>1</th>
<th>0</th>
<th>地址</th>
</tr>
</thead>
<tbody><tr>
<td>00H</td>
<td>R4</td>
<td>R3</td>
<td>R2</td>
<td>R1</td>
<td>R0</td>
<td>G4</td>
<td>G3</td>
<td>G2</td>
<td>G1</td>
<td>G0</td>
<td>B4</td>
<td>B3</td>
<td>B2</td>
<td>B1</td>
<td>B0</td>
<td>–</td>
<td>0X4D000400</td>
</tr>
<tr>
<td>01H</td>
<td>R4</td>
<td>R3</td>
<td>R2</td>
<td>R1</td>
<td>R0</td>
<td>G4</td>
<td>G3</td>
<td>G2</td>
<td>G1</td>
<td>G0</td>
<td>B4</td>
<td>B3</td>
<td>B2</td>
<td>B1</td>
<td>B0</td>
<td>–</td>
<td>0X4D000404</td>
</tr>
<tr>
<td>… …</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>… …</td>
</tr>
<tr>
<td>FFH</td>
<td>R4</td>
<td>R3</td>
<td>R2</td>
<td>R1</td>
<td>R0</td>
<td>G4</td>
<td>G3</td>
<td>G2</td>
<td>G1</td>
<td>G0</td>
<td>B4</td>
<td>B3</td>
<td>B2</td>
<td>B1</td>
<td>B0</td>
<td>–</td>
<td>0X4D0007FC</td>
</tr>
<tr>
<td>VD引脚号</td>
<td>23</td>
<td>22</td>
<td>21</td>
<td>20</td>
<td>19</td>
<td>15</td>
<td>14</td>
<td>13</td>
<td>12</td>
<td>11</td>
<td>7</td>
<td>6</td>
<td>5</td>
<td>4</td>
<td>3</td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>注：</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>①0X4D000400是调色板的起始地址。</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>②5：5：5：1格式下，VD18、VD10和VD2三个数据线中都是亮度值1，即最低位的值。</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>③当LCDCCON5寄存器中的VSTATUS、HSTATUS有效时，不能读写调色板。</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>各模式下用来传输红、绿、蓝三种原色的颜色值VD数据线如下表所示：</p>
<table>
<thead>
<tr>
<th>24BPP</th>
<th>16BPP&#x2F;8BPP 5：6：5格式</th>
<th>16BPP&#x2F;8BPP 5：5：5：1格式</th>
</tr>
</thead>
<tbody><tr>
<td>红色</td>
<td>VD[23:16]</td>
<td>VD[23:19]</td>
</tr>
<tr>
<td>绿色</td>
<td>VD[15:8]</td>
<td>VD[15:10]</td>
</tr>
<tr>
<td>蓝色</td>
<td>VD[7:0]</td>
<td>VD[7:3]</td>
</tr>
</tbody></table>
<p>没有用到的数据线其电平为0，从这个观点来看，无论是24BPP模式还是16BPP、8BPP模式，24根数据线VD[23:0]都被用到了。事实上，一个TFT LCD能处理的像素位宽是固定的，即它的数据线的数目是固定的。红、绿、蓝3类信号线总是连接到各字节中的高位；软件设置24BPP、16BPP、8BPP以及调色板等，只会影响到色值的精度。</p>
<h3 id="使用TFT-LCD时LCD控制器的寄存器设置"><a href="#使用TFT-LCD时LCD控制器的寄存器设置" class="headerlink" title="使用TFT LCD时LCD控制器的寄存器设置"></a>使用TFT LCD时LCD控制器的寄存器设置</h3><p>LCD控制器中REGBANK的17个寄存器可以分为6种，如下表所示：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>LCDCON1-LCDCON5</td>
<td>用于选择LCD类型，设置各类控制信号的时间特性等</td>
</tr>
<tr>
<td>LCDSADDR1-LCDSADDR3</td>
<td>用于设置帧内存的地址</td>
</tr>
<tr>
<td>TPAL</td>
<td>临时调色板寄存器，可以快速的输出一帧单色的图像</td>
</tr>
<tr>
<td>LCDINTPND<br>LCDSRCPND<br>LCDINTMSK</td>
<td>用于LCD的中断，在一般应用中无需中断</td>
</tr>
<tr>
<td>REDLUT <br> GREENLUT <br> BLUELUT <br> DITHMODE</td>
<td>专用于STNLCD</td>
</tr>
<tr>
<td>TCONSEL</td>
<td>专用于SEC TFT LCD</td>
</tr>
</tbody></table>
<p>对于TFT LCD，一般情况下只需要设置前两种寄存器；在8BPP模式下，如果想快速的输出一帧单色图，可以借助TPAL寄存器。</p>
<ol>
<li><p>LCD控制寄存器LCDCON1<br>用于选择LCD类型、设置像素时钟、使能LCD信号的输出等，格式如下表：</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>位</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>LINECNT</td>
<td>[27:18]</td>
<td>只读，每输出一个有效行其值减一，从LINEVAL减到0</td>
</tr>
<tr>
<td>CLKVAL</td>
<td>[17:8]</td>
<td>用于设置VCLK（时钟）<br> 对于TFT LCD，VCLK &#x3D; HCLK &#x2F; [(CLKVAL + 1) x 2](CLKVAL &gt;&#x3D; 0)</td>
</tr>
<tr>
<td>MMODE</td>
<td>[7]</td>
<td>设置VM信号的反转效率，用于STN LCD</td>
</tr>
<tr>
<td>PNRMODE</td>
<td>[6:5]</td>
<td>设置LCD的类型，对于TFT LCD 设为0b11</td>
</tr>
<tr>
<td>BPPMODE</td>
<td>[4:1]</td>
<td>设置BPP，对于TFT LCD：<br>0b1000 &#x3D; 1bpp <br> 0b1001 &#x3D; 2bpp <br> 0b1010 &#x3D; 4bpp <br> 0b1011 &#x3D; 8bpp <br> 0b1100 &#x3D; 16bpp <br> 0b1101 &#x3D; 24bpp</td>
</tr>
<tr>
<td>ENVID</td>
<td>[0]</td>
<td>LCD信号输出使能位，0：禁止，1：使能</td>
</tr>
</tbody></table>
</li>
<li><p>LCD控制寄存器LCDCON2<br>用于设置垂直方向各信号的时间参数，格式如下表：</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>位</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>VBPD</td>
<td>[31:24]</td>
<td>VSYNC信号脉冲之后，还要经过（VBPD + 1）个HSYNC信号周期，有效的行数据才出现</td>
</tr>
<tr>
<td>LINEVAL</td>
<td>[23:14]</td>
<td>LCD的垂直宽度：（LINEVAL + 1）行</td>
</tr>
<tr>
<td>VFPD</td>
<td>[13:6]</td>
<td>一帧中的有效行数据完结后，到下一个VSYNC信号有效前的无效行数目：VFPD + 1</td>
</tr>
<tr>
<td>VSPW</td>
<td>[5:0]</td>
<td>表示VSYNC信号的脉冲宽度为（VSPW + 1）个HSYNC信号周期，即（VSPW + 1）行，这（VSPW + 1）行的数据无效</td>
</tr>
</tbody></table>
</li>
<li><p>LCD控制器LCDCON3<br>用于设置水平方向信号的时间参数，格式如下表所示：</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>位</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>HBPD</td>
<td>[25:19]</td>
<td>HSYNC信号脉冲之后，还要经过（HBPD + 1）个VCLK信号周期，有效的行数据才出现</td>
</tr>
<tr>
<td>HOZVAL</td>
<td>[18:8]</td>
<td>LCD的水平宽度：（HOZVAL + 1）列（像素点）</td>
</tr>
<tr>
<td>HFPD</td>
<td>[7:0]</td>
<td>一行中的有效数据完结后，到下一个HSYNC信号有效前的无效像素数目：HFPD + 1</td>
</tr>
</tbody></table>
</li>
<li><p>LCD控制寄存器LCDCON4<br>对于TFT LCD，这个寄存器只用来设置HSYNC信号的脉冲宽度，位[7:0]的数值称为HSPW，表示脉冲宽度为（HSPW + 1）个VCLK周期。</p>
</li>
<li><p>LCD控制寄存器LCDCON5<br>用于设置各个控制信号的极性，并可以从中读到一些状态信息。如下表所示：</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>位</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>VSTATUS</td>
<td>[16:15]</td>
<td>只读，垂直状态。<br> 00:正处于VSYNC信号脉冲期间 <br> 01:正处于VSYNC信号结束到行有效期间 <br>10:正处于行有效期间 <br>11:正处于行有效结束到下一个VSYNC之间</td>
</tr>
<tr>
<td>HSTATUS</td>
<td>[14:13]</td>
<td>只读，水平状态。<br> 00:正处于HSYNC信号脉冲期间 <br> 01:正处于HSYNC信号结束到像素有效期间 <br>10:正处于像素有效期间 <br>11:正处于像素有效结束到下一个HSYNC之间</td>
</tr>
<tr>
<td>BPP24BL</td>
<td>[12]</td>
<td>设置TFT LCD的显示模式为24BPP时，一个4字节中哪3个字节有效。<br> 0:LSB有效（低地址的3字节）；1：MSB（高地址的3字节）；</td>
</tr>
<tr>
<td>FRM565</td>
<td>[11]</td>
<td>设置TFT LCD的显示模式为16BPP时，使用的数据格式。<br> 0表示5：5：5：1格式；1表示5：6：5 格式</td>
</tr>
<tr>
<td>INVVCLK</td>
<td>[10]</td>
<td>设置VCLK信号有效沿的极性。 <br> 0：在VCLK的下降沿读取数据；1：在VCLK的上升沿读取数据。</td>
</tr>
<tr>
<td>INVVLINE</td>
<td>[9]</td>
<td>设置VLINE&#x2F;HSYNC脉冲的极性。<br> 0：正常的极性；1：反转的极性</td>
</tr>
<tr>
<td>INVVFRAME</td>
<td>[8]</td>
<td>设置VFRAME&#x2F;VSYNC脉冲的极性。<br> 0：正常的极性；1：反转的极性</td>
</tr>
<tr>
<td>INVVD</td>
<td>[7]</td>
<td>设置VD数据线表示数据（0&#x2F;1）的极性。<br> 0：正常的极性；1：反转的极性</td>
</tr>
<tr>
<td>INVVDEN</td>
<td>[6]</td>
<td>设置VDEN信号的极性。<br> 0：正常的极性；1：反转的极性</td>
</tr>
<tr>
<td>INVPWREN</td>
<td>[5]</td>
<td>设置PWREN信号的极性。<br> 0：正常的极性；1：反转的极性</td>
</tr>
<tr>
<td>INVLEND</td>
<td>[4]</td>
<td>设置LEND信号的极性。<br> 0：正常的极性；1：反转的极性</td>
</tr>
<tr>
<td>PWREN</td>
<td>[3]</td>
<td>LCD_PWREN信号输出使能。<br> 0：禁止；1：输出</td>
</tr>
<tr>
<td>ENLEND</td>
<td>[2]</td>
<td>LEND信号输出使能。<br> 0：禁止；1：输出</td>
</tr>
<tr>
<td>BSWP</td>
<td>[1]</td>
<td>字节交换使能<br> 0：禁止；1：输出</td>
</tr>
<tr>
<td>HWSWP</td>
<td>[1]</td>
<td>半字（2字节）交换使能<br> 0：禁止；1：输出</td>
</tr>
</tbody></table>
</li>
<li><p>帧内存地址寄存器LCDSADDR1-LCDSADDR3<br>帧内存可以很大，而真正要显示的区域被称为视口（view point），它处于帧内存之内。这3个寄存器用于确定帧内存的起始地址，定位视口在帧内存的位置。下图给出了帧内存和视口之间的关系：<br><img src="/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/7.jpeg" alt="img not found"><br>各寄存器格式如下表所示：</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>LCDSADDR1 功能</th>
<th>位</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>LCDBANK</td>
<td>[29:21]</td>
<td>用来保存帧内存起始地址A[30:22]，帧内存起始地址为4MB对齐。</td>
</tr>
<tr>
<td>LCDBASEU</td>
<td>[20:0]</td>
<td>对于TFT LCD，用来保存视口（view point），所对应的内存起始地址A[21:1]，这块内存地址也称为LCD的帧缓冲区（frame buffer）</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>LCDSADDR2 功能</th>
<th>位</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>LCDBASEL</td>
<td>[20:0]</td>
<td>对于TFT LCD，用来保存LCD的帧缓冲区结束地址A[21:1]，其值可如下计算：LCDBASEL &#x3D; LCDBASEU + （PAGEWIDTH + OFFSICE）x （LINEVAL + 1）</td>
</tr>
</tbody></table>
<p>注：可以修改LCDBASEU、LCDBASEL的值来实现图像的移动，不过不能在一帧图像的结束阶段（LCDCON1寄存器的LINECNT为0时）进行修改，因为此时LCD控制器会优先取得下一帧的数据，之后才会改变这些值，这样的话，这些数据就与新的帧缓冲区不一致。</p>
<table>
<thead>
<tr>
<th>LCDSADDR3 功能</th>
<th>位</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>OFFSIZE</td>
<td>[21:11]</td>
<td>表示上一行最后一个数据与下一行第一个数据间地址差值的一半，即以半字为单位的地址差（0表示两行数据是紧接着的，1表示它们之间相差2个字节，依次类推）</td>
</tr>
<tr>
<td>PAGEWIDTH</td>
<td>[10:0]</td>
<td>视口的宽带，以半字为单位</td>
</tr>
</tbody></table>
<p>注：OFFSIZE、PAGEWIDTH的值只能在ENVID（LCDCON1寄存器的信号输出使能）为0时修改。</p>
<ol start="7">
<li>临时调色板寄存器TPAL<br>如果要输出一帧单色的图像，可以在TPAL寄存器中设定这个颜色值，然后使能TPAL寄存器，这种方法可以避免修改整个调色板或帧缓冲区。TPAL寄存器格式如下表所示：<table>
<thead>
<tr>
<th>功能</th>
<th>位</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>TPALEN</td>
<td>[24]</td>
<td>调色板寄存器使能位。<br> 0：禁止 1：使能</td>
</tr>
<tr>
<td>TPALVAL</td>
<td>[23:0]</td>
<td>颜色值。 <br> TPALVAL[23:16]：红色 <br> TPALVAL[15:8]：绿色 <br> TPALVAL[7:0]：蓝色</td>
</tr>
</tbody></table>
</li>
</ol>
<p>注：临时调色板寄存器TPAL可以用在任何显示模式下，并非只能用在8BPP模式下。</p>
<h1 id="TFT-LCD显示实例"><a href="#TFT-LCD显示实例" class="headerlink" title="TFT LCD显示实例"></a>TFT LCD显示实例</h1><h2 id="程序设计"><a href="#程序设计" class="headerlink" title="程序设计"></a>程序设计</h2><p>本实例的目的是从串口输出一个菜单，从中选择各种方法进行测试，比如画线、画圆、显示单色、使用调色板等。</p>
<h2 id="代码设计"><a href="#代码设计" class="headerlink" title="代码设计"></a>代码设计</h2><p>与LCD相关的文件有3个：lcddrv.c、framebuffer.c和lcdlib.c（及相应的头文件）。<br><img src="/2022/08/27/LCD%E6%8E%A7%E5%88%B6%E5%99%A8/8.jpeg" alt="img not found"></p>
<ol>
<li>lcddrv.c封装了对LCD控制器、调色板的访问函数，可以设置LCD的显示模式、开启&#x2F;关闭LCD、设置调色板等。</li>
<li>framebuffer.c直接操作帧缓冲区（frame buffer），实现了画点、画线、画圆、清屏等操作。</li>
<li>lcdlib.c调用前两个文件提供的函数在LCD上进行各种操作。</li>
</ol>
<h3 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span>(getc())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        Test_Lcd_Tft_8Bit_240320();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        Test_Lcd_Tft_16Bit_240320();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        Test_Lcd_Tft_8Bit_640480();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;4&#x27;</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        Test_Lcd_Tft_16Bit_640480();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它根据串口的输入选择是以”240x320、8bpp“、”240x320、16bpp“、”640x480、8bpp“或”640x480、16bpp“的显示模式来操作LCD，所调用的4个函数都在lcdlib.c中实现。</p>
<h3 id="lcdlib-c"><a href="#lcdlib-c" class="headerlink" title="lcdlib.c"></a>lcdlib.c</h3><p>8BPP模式将用到调色板，其操作比16BPP模式稍为复杂，但是大部分仍是相似的。下面以<code>Test_Lcd_Tft_8Bit_240320()</code>为例进行说明：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">以240x320、8bpp的显示模式测试TFT LCD</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Test_Lcd_Tft_8Bit_240320</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Lcd_Port_Init();                        <span class="comment">//设置LCD引脚</span></span><br><span class="line">    Tft_Lcd_Init(MODE_TFT_8BIT_240320);     <span class="comment">//初始化LCD控制器</span></span><br><span class="line">    Lcd_PowerEnable(<span class="number">0</span>,<span class="number">1</span>);                   <span class="comment">//设置LCD_PWREN有效，它用于打开LCD的电源</span></span><br><span class="line">    Lcd_EnvidOnOff(<span class="number">1</span>);                      <span class="comment">//使能LCD控制器输出信号</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第6行所涉及的GPIO引脚用于LCD功能。<br>第7行调用Tft_Lcd_Init函数初始化LCD控制器，即设置各个控制信号的时间特性、设置LCD的显示模式、设置帧缓冲区的地址等，它是lcddrv.c中最复杂的函数，在后面会详细分析这个函数。<br>进行第6、7行的初始化之后，只要打开LCD，帧缓冲区中的数据就会被LCD控制器自动地发送到LCD上去显示。打开操作由8、9行来完成。<br>第8行发出LCD_PWREN信号。对于有电源开关控制引脚的LCD，可以使用LCD_PWREN来打开或关闭LCD。LCD_PWREN信号的极性可以设置。<br>第9行使能LCD控制器输出信号，这时，帧缓冲区中的数据就开始在LCD上显示出来了。<br>接下来就是按照设定的流程进行各类操作了，比如画线、清屏等，代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Lcd_Palette8Bit_Init();                     <span class="comment">//初始化调色板</span></span><br><span class="line">ClearScr(<span class="number">0x0</span>);                              <span class="comment">//清屏</span></span><br><span class="line"></span><br><span class="line">getc();</span><br><span class="line">Draw_Line(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,<span class="number">0</span>,<span class="number">0</span>);                     <span class="comment">//颜色为DEMO256pal[0]</span></span><br><span class="line">Draw_Line(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,<span class="number">10</span>,<span class="number">1</span>);                    <span class="comment">//颜色为DEMO256pal[1]</span></span><br><span class="line">Draw_Line(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,<span class="number">20</span>,<span class="number">2</span>);                    <span class="comment">//颜色为DEMO256pal[2]</span></span><br><span class="line">Draw_Line(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,<span class="number">40</span>,<span class="number">4</span>);                    <span class="comment">//颜色为DEMO256pal[4]</span></span><br><span class="line">Draw_Line(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,<span class="number">80</span>,<span class="number">8</span>);                    <span class="comment">//颜色为DEMO256pal[8]</span></span><br><span class="line">Draw_Line(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,<span class="number">160</span>,<span class="number">16</span>);                  <span class="comment">//颜色为DEMO256pal[16]</span></span><br><span class="line"></span><br><span class="line">getc();</span><br><span class="line">Mire();                                     <span class="comment">//画圆</span></span><br><span class="line"></span><br><span class="line">getc();</span><br><span class="line">ClearScr(<span class="number">128</span>);                              <span class="comment">//输出单色图像，颜色为DEMO256pal[128]</span></span><br><span class="line"></span><br><span class="line">getc();</span><br><span class="line">ClearScrWithTmpPlt(<span class="number">0x0000ff</span>);               <span class="comment">//输出单色图像，颜色为蓝色</span></span><br><span class="line"></span><br><span class="line">getc();</span><br><span class="line">DisableTmpPlt();                            <span class="comment">//关闭临时调色板寄存器</span></span><br><span class="line">ChangePalette(<span class="number">0xffff00</span>);                    <span class="comment">//改变整个调色板为黄色，输出单色图像</span></span><br><span class="line"></span><br><span class="line">getc();</span><br><span class="line">Lcd_EnvidOnOff(<span class="number">0</span>);                          <span class="comment">//停止</span></span><br></pre></td></tr></table></figure>
<p>上述函数分3类：</p>
<ol>
<li>清屏函数ClearScr、画线函数DrawLine，都是通过framebuffer.c中的PutPixel函数来设置帧缓冲区中的数据，以像素为单位修改颜色来实现的。</li>
<li>Lcd_Palette8Bit_Init函数设置调色板，ChangePalette函数通过设置调色板来实现清屏功能，不涉及帧缓冲区，它在lcddrv.c中实现。</li>
<li>ClearScrWithTmpPlt函数则是通过临时调色板寄存器来快速的输出单色的图像，也不涉及帧缓冲区，它在lcddrv.c中实现。<br>lcddrv.c、framebuffer.c文件中的各个函数才是本实例的关键。可以认为lcddrv.c是对操作各寄存器的封装，framebuffer.c则是对操作图像数据的封装。先看lcddrv.c文件。</li>
</ol>
<h3 id="lcddrv-c"><a href="#lcddrv-c" class="headerlink" title="lcddrv.c"></a>lcddrv.c</h3><p>这个文件的重点在于Tft_Lcd_Init、Lcd_Palette8Bit_Init。</p>
<ol>
<li><p>Lcd_Port_Init函数<br>设置所涉及的GPIO引脚用于LCD功能。GPIO功能的设置对读者来说已经很熟悉了，不再赘述。</p>
</li>
<li><p>Tft_Lcd_Init函数<br>用于初始化LCD控制器，即设置各个控制信号的时间特性、设置LCD的显示模式、设置帧缓冲区的地址等。<br>首先是对5个控制寄存器LCDCON1-LCDCON5的设置，代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">初始化LCD控制器</span></span><br><span class="line"><span class="comment">输入参数：</span></span><br><span class="line"><span class="comment">type：显示模式</span></span><br><span class="line"><span class="comment">    MODE_TFT_8BIT_240320 : 240*320 8bpp 的TFT LCD</span></span><br><span class="line"><span class="comment">    MODE_TFT_16BIT_240320 : 240*320 16bpp 的TFT LCD</span></span><br><span class="line"><span class="comment">    MODE_TFT_8BIT_640480 : 640*480 8bpp 的TFT LCD</span></span><br><span class="line"><span class="comment">    MODE_TFT_16BIT_640480 : 640*480 16bpp 的TFT LCD</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Tft_Lcd_Init</span><span class="params">(<span class="type">int</span> type)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">switch</span>(type)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> MODE_TFT_8BIT_240320:</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        设置LCD控制器的控制寄存器LCDCON1-LCDCON5</span></span><br><span class="line"><span class="comment">        1. LCDCON1</span></span><br><span class="line"><span class="comment">            设置VCLK的频率：VCLK（Hz）= HCLK/[(CLKVAL+1)x2]</span></span><br><span class="line"><span class="comment">            选择LCD类型：TFT LCD</span></span><br><span class="line"><span class="comment">            设置显示模式：8BPP</span></span><br><span class="line"><span class="comment">            先禁止LCD信号输出</span></span><br><span class="line"><span class="comment">        2. LCDCON2/3/4</span></span><br><span class="line"><span class="comment">            设置控制信号的时间参数</span></span><br><span class="line"><span class="comment">            设置分辨率，即行数及列数</span></span><br><span class="line"><span class="comment">        现在，可以根据公式计算出显示器的频率</span></span><br><span class="line"><span class="comment">        当HCLK = 100MHz时，</span></span><br><span class="line"><span class="comment">        Frame Rate = 1/[&#123;(VSPW+1)+(VBPD+1)+(LINEVAL+1)+(VFPD+1)&#125; x &#123; (HSPW+1)+(HBPD+1)+(HFPD+1)+(HOZVAL+1) &#125; x &#123; 2 x ( CLKVAL+1) / (HCLK)&#125;] = 60Hz</span></span><br><span class="line"><span class="comment">        3. LCDCON5</span></span><br><span class="line"><span class="comment">            设置显示模式为8BPP时，调色板中的数据格式为5：6：5</span></span><br><span class="line"><span class="comment">            设置HSYNC、VSYNC脉冲的极性：反转字节交换使能</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        LCDCON1 = (CLKVAL_TFT_240320 &lt;&lt; <span class="number">8</span>) | (LCDTYPE_TFT &lt;&lt; <span class="number">5</span>) | (BPPMODE_8BPP &lt;&lt; <span class="number">1</span>) | (ENVID_DISABLE &lt;&lt; <span class="number">0</span>);</span><br><span class="line">        LCDCON2 = (VBPD_240320 &lt;&lt; <span class="number">24</span>) | (LINEVAL_TFT_240320 &lt;&lt; <span class="number">14</span>) | (VFPD_240320 &lt;&lt; <span class="number">6</span>) | (VSPW_240320);</span><br><span class="line">        LCDCON3 = (HBPD_240320 &lt;&lt; <span class="number">19</span>) | (HOZVAL_TFT_240320 &lt;&lt; <span class="number">8</span>) | (HFPD_240320);</span><br><span class="line">        LCDCON4 = (HSPW_240320);</span><br><span class="line">        LCDCON5 = (FORMAT8BPP_565 &lt;&lt; <span class="number">11</span>) | (HSYNC_INV &lt;&lt; <span class="number">9</span>) | (VSYNC_INV &lt;&lt; <span class="number">8</span>) | (BSWP &lt;&lt; <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码中的注释可以帮助读者理解这些代码，比较困难的是时间参数VSPW、VBPD、VFPD、HSPW、HBPD、HFPD、CLKVAL的设置。对于CRT显示器，当它的频率在60Hz时，人眼会感到明显的闪烁；而对于LCD，在60Hz时显示效果就很好。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Frame Rate = <span class="number">1</span>/[&#123;(VSPW+<span class="number">1</span>)+(VBPD+<span class="number">1</span>)+(LINEVAL+<span class="number">1</span>)+(VFPD+<span class="number">1</span>)&#125; x &#123; (HSPW+<span class="number">1</span>)+(HBPD+<span class="number">1</span>)+(HFPD+<span class="number">1</span>)+(HOZVAL+<span class="number">1</span>) &#125; x &#123; <span class="number">2</span> x ( CLKVAL+<span class="number">1</span>) / (HCLK)&#125;];</span><br></pre></td></tr></table></figure>
<p>接下来是对地址寄存器LCDSADDR1-LCDSADDR3的设置。本程序中，帧内存与视图吻合，即图中的OFFSIZE为0，LCDBANK、LCDBASEU指向同一个地址（同一地址的不同位）。<br>需要注意的是，8BPP的显示模式要用到调色板，帧缓冲区中的数据不是像素的颜色值，而是调色板中的索引值，真正的颜色值在调色板中。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">设置LCD控制器的地址寄存器LCDSADDR1-LCDSADDR3</span></span><br><span class="line"><span class="comment">帧内存与视口（view point）完全吻合，</span></span><br><span class="line"><span class="comment">图像数据格式如下（8BPP时，帧缓存区中的数据为调色板中的索引值）：</span></span><br><span class="line"><span class="comment">            |----width----|</span></span><br><span class="line"><span class="comment">        y/x 0   1    2   239</span></span><br><span class="line"><span class="comment">         0  idx idx  idx idx</span></span><br><span class="line"><span class="comment">         1  idx idx  idx idx</span></span><br><span class="line"><span class="comment">1. LCDSADDR1</span></span><br><span class="line"><span class="comment">    设置LCDBANK、LCDBASEU</span></span><br><span class="line"><span class="comment">2. LCDSADDR2</span></span><br><span class="line"><span class="comment">    设置LCDBASEL：帧缓冲区的结束地址A[21:1]</span></span><br><span class="line"><span class="comment">3. LCDSADDR3</span></span><br><span class="line"><span class="comment">    OFFSIZE等于0，PAGEWIDTH等于（240/2）</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">LCDSADDR1 = ((LCDFRAMEBUFFER &gt;&gt; <span class="number">22</span>) &lt;&lt; <span class="number">21</span>) | LOWER21BITS(LCDFRAMEBUFFER &gt;&gt; <span class="number">1</span>);</span><br><span class="line">LCDSADDR2 = LOWER21BITS((LCDFRAMEBUFFER + (LINEVAL_TFT_240320 + <span class="number">1</span>) x (HOZVAL_TFT_240320+<span class="number">1</span>) x1) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">LCDSADDR3 = (<span class="number">0</span> &lt;&lt;<span class="number">11</span> ) | (LCD_XSIZE_TFT_240320/<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>第16行将帧缓冲区的起始地址写入LCDSADDR1寄存器。<br>第17行先计算帧缓冲区的结束地址，再取其位[21:1]存入LCDSADDR2中。这个地址值在本实例中即是“LCDFRAMEBUFFER + 320 x 240 x 1”,其中的“x1”表示在8BPP中一个像素使用1个字节来表示（对于16BPP，则是“x2”）。<br>在设置寄存器的最后，禁止临时调色板寄存器，现在还没有用到它。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*禁止临时调色板寄存器*/</span></span><br><span class="line">TPAL = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>最后，将显示模式的主要参数记录下来，在framebuffer.c中需要用到。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fb_base_addr = LCDFRAMEBUFFER;</span><br><span class="line">bpp = <span class="number">8</span>;</span><br><span class="line">xsize = <span class="number">240</span>;</span><br><span class="line">ysize = <span class="number">320</span>;</span><br></pre></td></tr></table></figure>
<p>需要说明的是，显示模式为8BPP时，LCDCON5中BSWAP位设为1，表示“字节交换使能”，这时帧缓存区中的数据与屏幕上的像素位置关系如上图13.6所示；显示模式为16BPP时，LCDCON5中HWSWAP位设为1，表示“半字交换使能”，这时帧缓冲区的数据与屏幕上的像素位置关系如图13.5所示。他们都是“低地址的数据”对应“位置靠前”的像素。</p>
</li>
<li><p>Lcd_Palette8Bit_Init函数<br>设置调色板中的数据：调试板大小为256x16，而8BPP模式中每个像素的索引值占据8位，刚好有256个索引值。代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">设置调色板</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Lcd_Palette8Bit_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">unsigned</span> <span class="type">int</span> *palette;</span><br><span class="line"></span><br><span class="line">    LCDCON5 |= (FORMAT8BPP_565 &lt;&lt; <span class="number">11</span>);              <span class="comment">//设置调色板中数据格式为5：6：5</span></span><br><span class="line"></span><br><span class="line">    palette = (<span class="keyword">volatile</span> <span class="type">unsigned</span> <span class="type">int</span> *)PALETTE;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>;i &lt; <span class="number">256</span>;i++)</span><br><span class="line">        *palette++ = DEMO256pal[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调色板中用16BPP的格式来表示颜色，第9行设置调色板中数据的格式为5：6：5。<br>第12、13行将数组DEMO256pal中的数据写入调色板中。</p>
</li>
<li><p>ChangePalette函数<br>以给定的颜色填充整个调色板。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">改变调色板为一种颜色</span></span><br><span class="line"><span class="comment">输入参数：</span></span><br><span class="line"><span class="comment">    color：颜色值，格式为0xRRGGBB</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">ChangePalette</span><span class="params">(UINT32 color)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> red,green,blue;</span><br><span class="line">    UNT32 *palette;</span><br><span class="line"></span><br><span class="line">    palette = (UINT32 *)PALETTE;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>;i &lt; <span class="number">256</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        red = (color &gt;&gt; <span class="number">19</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">        green = (color &gt;&gt; <span class="number">10</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">        blue = (color &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line"></span><br><span class="line">        color = (red &lt;&lt; <span class="number">11</span>) | (greee &lt;&lt; <span class="number">5</span>) | (blue);                <span class="comment">//格式5：6：5</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>((LCDCON5 &gt;&gt; <span class="number">16</span>) == <span class="number">2</span>);                                <span class="comment">//等待直到VSTATUS不为“有效”</span></span><br><span class="line">        *palette++ = color;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第15-19行从0xRRGGBB格式的变量中，提取8位红色值的高5位，8位绿色值的高6位，8位蓝色值的高5位组成5：6：5格式的16BPP颜色值。<br>第21行检测当前VSYNC信号的状态，如果它处于有效的状态，则等待。前面说过，读写调色板时，VSTATUS、HSTATUS不能处于有效状态。这里当VSTATUS不是“有效”状态时，HSTATUS也不能是“有效”状态。<br>第22行将新数据写入调色板。</p>
</li>
<li><p>Lcd_PowerEnable函数<br>用于是否控制发出LCD_PWREN信号。对于有电源开关控制引脚的LCD，可以使用LCD_PWREN来打开或关闭LCD。LCD_PWREN信号的极性可以设置。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">设置是否输出LCD电源开关信号LCD_PWREN</span></span><br><span class="line"><span class="comment">输入参数：</span></span><br><span class="line"><span class="comment">    invpwren：</span></span><br><span class="line"><span class="comment">        0表示LCD_PWREN有效时为正常极性</span></span><br><span class="line"><span class="comment">        1表示LCD_PWREN有效时为反转极性</span></span><br><span class="line"><span class="comment">    pwren：</span></span><br><span class="line"><span class="comment">        0表示LCD_PWREN输出有效</span></span><br><span class="line"><span class="comment">        1表示LCD_PWREN输出无效</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Lcd_PowerEnable</span><span class="params">(<span class="type">int</span> invpwren,<span class="type">int</span> pwren)</span></span><br><span class="line">&#123;</span><br><span class="line">    GPGCON = (GPGCON &amp; (~ (<span class="number">3</span> &lt;&lt; <span class="number">8</span>))) | (<span class="number">3</span> &lt;&lt; <span class="number">8</span>);                <span class="comment">//GPG4用作LCD_PWREN</span></span><br><span class="line">    GPGUP = (GPGUP &amp; (~ (<span class="number">1</span> &lt;&lt; <span class="number">4</span>))) | (<span class="number">1</span> &lt;&lt; <span class="number">4</span>);                  <span class="comment">//禁止内部上拉</span></span><br><span class="line"></span><br><span class="line">    LCDCON5 = (LCDCON5 &amp; (~ (<span class="number">1</span> &lt;&lt; <span class="number">5</span>))) | (invpwrwen &lt;&lt; <span class="number">5</span>);      <span class="comment">//设置LCD_PWREN的极性：正常/反转</span></span><br><span class="line">    LCDCON5 = (LCDCON5 &amp; (~ (<span class="number">1</span> &lt;&lt; <span class="number">3</span>))) | (pwren &lt;&lt; <span class="number">3</span>);          <span class="comment">//设置是否输出LCD_PWREN</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Lcd_EnvidOnOff函数<br>用于控制是否使能LCD控制器输出各个LCD信号，当设置如控制寄存器、地址寄存器之后，即可调用此函数输出各个LCD信号，这样，帧缓冲区中的数据即发送给LCD。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">设置LCD控制器是否输出信号</span></span><br><span class="line"><span class="comment">输入参数：</span></span><br><span class="line"><span class="comment">onoff：</span></span><br><span class="line"><span class="comment">    0：关闭</span></span><br><span class="line"><span class="comment">    1：打开</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Lcd_EnvidOnOff</span><span class="params">(<span class="type">int</span> onoff)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(onoff == <span class="number">1</span>)</span><br><span class="line">        LCDCON1 |= <span class="number">1</span>;           <span class="comment">//ENVID ON</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        LCDCON1 &amp;= <span class="number">0x3fffe</span>;     <span class="comment">//ENVID OFF</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>ClearScrWithTmpPlt、DisableTmpPlt函数<br>ClearScrWithTmpPlt函数设置颜色值并使能TPAL寄存器，这使得LCD上显示单一颜色的图像。DisableTmpPlt函数停止TPAL寄存器的功能，继续输出帧缓存区的图像。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">使用临时调色板寄存器输出单色图像</span></span><br><span class="line"><span class="comment">输入参数：</span></span><br><span class="line"><span class="comment">    color：颜色值，格式为0xRRGGBB</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ClearScrWithTmpPlt</span><span class="params">(UINT32 color)</span></span><br><span class="line">&#123;</span><br><span class="line">    TPAL = (<span class="number">1</span> &lt;&lt; <span class="number">24</span>) | ((color &amp; <span class="number">0xffffff</span>) &lt;&lt; <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">停止使用临时调色板寄存器</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">DisableTmpPlt</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    TPAL = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="framebuffer-c"><a href="#framebuffer-c" class="headerlink" title="framebuffer.c"></a>framebuffer.c</h3><p>此文件中有4个函数：画点函数PutPixel、画线函数DrawLine、绘制同心圆函数Mire、清屏函数ClearScr。后3个函数都是基于PutPixel函数实现的。PutPixel函数是framebuffer.c的核心，它在缓冲区中找到给定坐标的像素的内存，然后修改它的值。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="type">unsigned</span> <span class="type">int</span> fb_base_addr;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">unsigned</span> <span class="type">int</span> bpp;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">unsigned</span> <span class="type">int</span> xsize;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">unsigned</span> <span class="type">int</span> ysize;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">画点</span></span><br><span class="line"><span class="comment">输入参数：</span></span><br><span class="line"><span class="comment">    x,y：像素坐标</span></span><br><span class="line"><span class="comment">    color：颜色值</span></span><br><span class="line"><span class="comment">    对于16BPP：color的格式为0xAARRGGBB  AA是透明度，0-256，需要转换为5:6:5格式</span></span><br><span class="line"><span class="comment">    对于8BPP：color为调色板的索引值，颜色取决于调色板中的数值</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">PutPixel</span><span class="params">(UINT32 x,UINT32 y,UINT32 color)</span></span><br><span class="line">&#123;</span><br><span class="line">    UINT8 red,green,blue;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span>(bpp)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            UINT16 *addr = (UINT16 *)fb_base_addr + (y * xsize + x);</span><br><span class="line">            red = (color &gt;&gt; <span class="number">19</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">            green = (color &gt;&gt; <span class="number">10</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">            blue = (color &gt;&gt; <span class="number">3</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line"></span><br><span class="line">            color = (red &lt;&lt; <span class="number">11</span>) | (greee &lt;&lt; <span class="number">5</span>) | (blue);                <span class="comment">//格式5：6：5</span></span><br><span class="line">            *addr = (UINT16) color;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            UINT8 *addr = (UINT8 *)fb_base_addr + (y * xsize + x);</span><br><span class="line">            *addr = (UINT8) color</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第1-4行的4个变量在lcddrv.c中的Tft_Lcd_Init函数中设置，PutPixel函数根据它们来确定给定坐标的像素在缓冲区中的地址。<br>第22、34行分别计算16BPP、8BPP模式下给定坐标的像素在帧缓冲中的地址。对于16BPP模式，每个像素占据2字节；对于8BPP模式，每个像素占据1字节。<br>对于16BPP的显示模式，第22-25行从0xAARRGGBB中提取8位红色值的高5位，8位绿色值的高6位，8位蓝色值的高5位组成5：6：5格式的16BPP颜色值。<br>最后，第28、35行将颜色值（8BPP模式下为调色板索引值）写入帧缓冲区中，这样下一次显示的时候，新颜色就可以显示出来了。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8FLinux/" rel="tag"># 嵌入式Linux</a>
              <a href="/tags/LCD/" rel="tag"># LCD</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/08/25/IIC/" rel="prev" title="IIC">
                  <i class="fa fa-chevron-left"></i> IIC
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/08/30/ADC%E5%92%8CTP%E6%8E%A5%E5%8F%A3/" rel="next" title="ADC和TP接口">
                  ADC和TP接口 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Nibil</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">492k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">7:28</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
